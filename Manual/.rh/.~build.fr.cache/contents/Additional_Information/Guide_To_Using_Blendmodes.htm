 Guide d'utilisation des modes de fusion Si vous utilisez GameMaker Studio 2 depuis un certain temps, vous aurez presque certainement rencontré des modes de fusion et les avez probablement même utilisés dans vos jeux. Les modes de fusion sont un excellent moyen de changer la façon dont quelque chose est dessiné pour donner des effets graphiques intéressants et spécifiques, mais savez-vous comment ils fonctionnent et comment les utilisez-vous? C'est un sujet qui peut dérouter les gens et donc dans cette section, nous espérons dissiper certains des mystères entourant les modes de fusion et vous permettre de les utiliser au maximum dans vos jeux. APERÇU Les modes de fusion indiquent essentiellement à votre jeu de dessiner certaines choses mélangées avec tout ce qui est déjà dessiné au préalable. Tout ce que vous dessinez à l'écran est composé de quatre composants - rouge, vert, bleu et alpha - et par défaut, ils sont dessinés à l'écran en utilisant le mode de fusion bm_normal. Ce mode de fusion dessine tous les pixels avec leur couleur et leurs valeurs alpha essentiellement inchangées (bien que, plus loin dans cette section, vous verrez que ce n'est pas tout à fait vrai...), mais GameMaker Studio 2 a un certain nombre de modes de fusion intégrés qui peut être configuré pour modifier ce comportement. Lorsque GameMaker Studio 2 va dessiner un pixel, il y a une couleur source (la couleur du pixel que vous allez dessiner) et une couleur de destination (la couleur qui est déjà dans le pixel sur lequel nous dessinons). Lors de la détermination de la nouvelle couleur du pixel, GameMaker combinera les couleurs source et de destination en fonction du mode de fusion, comme mentionné ci-dessus. Chaque composant des couleurs est stocké sous forme de valeur à virgule flottante entre 0 et 1, et la nouvelle couleur est calculée en multipliant chaque composant de la couleur source par un certain facteur et en multipliant chaque composant de la couleur de destination par un autre facteur, puis en ajoutant le résultats ensemble composant par composant. MODES DE FUSION DE BASE GameMaker Studio 2 utilise la fonction gpu_set_blendmode () pour modifier le mélange utilisé par votre jeu pour dessiner. Vous appelleriez cela avant (par exemple) de dessiner un sprite, puis le remettriez à nouveau par la suite, quelque chose comme ceci:gpu_set_blendmode(bm_add); draw_self();
     gpu_set_blendmode(bm_normal);
   Ce code dessine l'image-objet d'instance à l'aide d'un mode de fusion additif. Le mode de fusion additif est défini à l'aide de l'une des GML disponibles, dont quatre pour les modes de base:bm_normal bm_add
     bm_subtract
     bm_max
   Nous avons déjà vu comment bm_normal regarde - puisque c'est ce que tout est par défaut! - continuons donc à regarder les trois autres plus en détail... bm_add Ce mode de fusion ajoute les couleurs des pixels source et de destination ensemble (mais n'affecte pas les valeurs alpha). Par exemple, si votre image d'arrière-plan est une couleur unie avec une valeur RVB de (100,15,70), puis que vous dessinez un rectangle avec un RVB de (120,25,30), alors (en utilisant bm_add) le fina RVB les valeurs pour chaque pixel du rectangle seraient (220, 40, 100). Notez que les valeurs de couleur ne peuvent pas dépasser 255 (ou moins de 0), donc tout ce qui ajoute plus que cela sera limité à 255. L'utilisation de ce mode de fusion est un excellent moyen d'obtenir ce look "néon glow", et est le plus souvent utilisé pour les effets d'éclairage, les lasers ou à peu près tout ce que vous voulez faire briller ou avoir une luminescence. bm_subtract Ce mode de fusion est un peu différent du précédent, car il fonctionne sur une base de pourcentage plutôt que sur une valeur directe. Ce pourcentage est ce qui sera soustrait de la couleur de destination (la couleur du pixel sur lequel dessiner). Pour mieux expliquer cela, regardons un exemple. Imaginez que vous souhaitiez réduire de 25% la valeur du rouge de tous les pixels dessinés dans une zone de la pièce. Vous devez d'abord obtenir 25% de 255, puis convertir cela en une valeur de couleur RVB, puis enfin l'utiliser avec bm_subtract pour dessiner sur la zone. Quelque chose comme ça:var red = (25 / 100) * 255;var col = make_colour_rgb(red, 0, 0);gpu_set_blendmode(bm_subtract);draw_rectangle_colour(0, 0, 128, 256, col, col, col, col, false);gpu_set_blendmode(bm_normal); En suivant la même règle, si vous vouliez simplement réduire la luminosité d'un arrière-plan de 50% alors vous auriez une couleur qui est 50% rouge, 50% vert et 50% bleu, c'est-à-dire: RVB (128, 128, 128). Ce mode de fusion est principalement utilisé pour dessiner des ombres ou pour créer des effets de fondu de sortie intéressants. bm_max Ce mode de fusion est plus complexe à expliquer, mais il multiplie essentiellement les couleurs source par l'alpha source, puis les ajoute aux valeurs de couleur de destination multipliées par les valeurs de couleur source inverses. Nous aborderons les mathématiques réelles derrière bm_max (et les autres modes de fusion) dans la deuxième partie de notre article, mais tout ce que vous devez savoir est que le résultat sera une couleur plus "saturée" et plus lumineuse, sans conduire à la même pureté brillance blanche qui en utilisant bm_add provoquera. Ce mode de fusion peut être utile lorsque vous devez dessiner des images qui se chevauchent sans qu'elles deviennent si lumineuses qu'elles ne peuvent pas être vues. Les parties lumineuses deviendront plus lumineuses, mais elles devraient toujours maintenir un niveau de couleur et de teinte. Notez cependant que la valeur alpha de l'image source influencera également l'effet final lors de l'utilisation de ce mode de fusion. Vous connaissez maintenant les bases de l'utilisation d'un mode de fusion dans GameMaker Studio 2. Il prend les valeurs RVB et alpha de l'image source (ce qui est dessiné) et les fusionne ensuite avec les valeurs RVB et alpha de la destination (ce qui est également dessiné). Ce mélange est effectué en multipliant les composants individuels pour chaque couleur de pixel et alpha par des quantités différentes, en fonction des effets que nous souhaitons obtenir. Avec ces connaissances, vous pouvez commencer à utiliser les modes de fusion dans vos jeux pour obtenir des lasers brillants, des ombres réalistes ou des effets de transition saturés, mais il reste encore plus à apprendre ici! Ci-dessous, nous examinons les modes de fusion étendus et explorons un peu les mathématiques derrière eux, afin que vous puissiez créer vos propres effets de fusion tels que la multiplication ou la superposition. Modes de fusion étendus Ci-dessus, nous avons parlé de la fonction gpu_set_blendmode(), mais maintenant nous allons regarder gpu_set_blendmode_ext(). Il s'agit (comme son nom l'indique) d'une fonction étendue pour définir des modes de fusion personnalisés, mais comment cela fonctionne-t-il? Jetons juste un coup d'œil à la réponse technique sèche avant d'aller plus loin: La fonction gpu_set_blendmode_ext(src, dest) indique le mode de fusion à utiliser pour la couleur source et la couleur de destination. La nouvelle couleur est un facteur multiplié par la source et un autre facteur multiplié par la destination. Ces facteurs sont définis avec cette fonction. Pour comprendre cela, la source et la destination ont toutes deux un composant rouge, vert, bleu et alpha. Donc, la source est (Rs, Gs, Bs, As ) et la destination est (Rd, Gd, Bd, Ad ). Toutes les valeurs sont considérées comme comprises entre 0 et 1. Maintenant, bien que ce texte soit correct et explique ce que font les modes de fusion, ce n'est pas vraiment intuitif... alors allons un peu plus en détail et expliquons de quoi il s'agit. Lorsque nous parlons de la source, nous parlons de la couleur et des valeurs alpha du pixel qui est dessiné, et lorsque nous parlons de la destination, nous parlons de la couleur et des valeurs alpha du pixel sur lequel il est dessiné. Pour simplifier les choses, nous pouvons écrire la couleur source sous forme de composants, comme ceci:(Rs, Gs, Bs, As) = le RVB et l'Alpha de la couleur que vous allez dessiner. Et la destination serait comme ceci:(Rd, Gd, Bd, Ad) = le RVB et l'Alpha de la couleur sur laquelle vous allez dessiner. Ainsi, lorsque nous dessinons quelque chose à l'écran, notre processeur graphique fait en fait ce qui suit pour chaque pixel:final_pixel_colour =  (Rs,Gs,Bs,As) * source_blend_factor + (Rd,Gd,Bd,Ad) * destination_blend_factor Les facteurs de fusion mentionnés ci-dessus sont définis dans GameMaker Studio 2 par un certain nombre de GML, et chacun représente un facteur par lequel les valeurs R, V, B et A de la source ou de la destination doivent être multipliées. Les facteurs disponibles sont:bm_zero: Le facteur de fusion est (0, 0, 0, 0)bm_one: Le facteur de fusion est (1, 1, 1, 1)bm_src_colour: Le facteur de fusion est (Rs, Gs, Bs, As)bm_inv_src_colour: Le facteur de mélange est (1-Rs, 1-Gs, 1-Bs, 1-As)bm_src_alpha: Le facteur de fusion est (As, As, As, As)bm_inv_src_alpha: Le facteur de fusion est (1-As, 1-As, 1-As, 1-As)bm_dest_alpha: Le facteur de fusion est (annonce, annonce, annonce, annonce)bm_inv_dest_alpha: Le facteur de fusion est (1 annonce, 1 annonce, 1 annonce, 1 annonce)bm_dest_colour: Le facteur de fusion est (Rd, Gd, Bd, Ad)bm_inv_dest_colour: Le facteur de fusion est (1-Rd, 1-Gd, 1-Bd, 1-Ad)bm_src_alpha_sat: Le facteur de fusion est (f, f, f, 1); f = min (As, 1-Ad) Les quatre modes de fusion «de base» de GameMaker Studio 2 sont en fait des composites de deux de ces facteurs de fusion. Exemple de fonctionnement de bm_normal Il est temps de regarder un exemple pratique de la façon dont cela se GameMaker pour le dessin dans GameMaker Studio 2. Pour cela, nous allons regarder bm_normal, qui est en réalité:gpu_set_blendmode_ext(bm_src_alpha, bm_inv_src_alpha); L'un des problèmes que les gens ont avec les modes de fusion est de visualiser les résultats, donc pour montrer les mathématiques derrière eux, nous utiliserons ce mode de fusion comme sujet de test car c'est le mode de fusion que tout le monde utilise le plus et nous savons exactement à quoi nous attendre. à partir de cela. Imaginons que nous dessinions un rectangle avec la couleur (128, 255, 64, 255) sur un arrière-plan avec la couleur (64, 128, 255, 255): Donc, notre mode de fusion ressemble à ceci:Source: (128, 255, 64, 255) = (0.5, 1, 0.25, 1)Destination: (64, 128, 255, 255) = (0.25, 0.5, 1, 1)bm_src_alpha (As, As, As, As) = (255, 255, 255, 255) = (1, 1, 1, 1)bm_inv_src_alpha (1-As, 1-As, 1-As, 1-As) =  (0, 0, 0, 0)(Rs,Gs,Bs,As)
      * bm_src_alpha + (Rd,Gd,Bd,Ad) * bm_inv_src_alpha(0.5, 1, 0.25, 1) * (1, 1, 1, 1) + (0.25, 0.5, 1, 1) * (0, 0, 0, 0)(0.5, 1, 0.25, 1) + (0, 0, 0, 0) = (0.5, 1, 0.25, 1) = (128, 255, 64, 255) Comme vous pouvez le voir, nous multiplions les valeurs de destination par 0, ce qui leur donne également une valeur de 0, ce qui signifie que les couleurs source sont inchangées, donc notre valeur de couleur finale est (128, 255, 64, 255). Vous pouvez voir comment l'inclusion d'alpha affecte également cette valeur:Source (128, 255, 64, 128) = (0.5, 1, 0.25, 0.5)Destination: (64, 128, 255, 255) = (0.25, 0.5, 1, 1)bm_src_alpha (As, As, As, As) = (128, 128, 128, 128) = (0.5, 0.5, 0.5, 0.5)bm_inv_src_alpha (1-As, 1-As, 1-As, 1-As) = (0.5, 0.5, 0.5,
      0.5)(Rs,Gs,Bs,As) * bm_src_alpha + (Rd,Gd,Bd,Ad) * bm_inv_src_alpha(0.5, 1, 0.25, 0.5) * (0.5, 0.5, 0.5, 0.5) + (0.25, 0.5, 1, 1) * (0.5, 0.5, 0.5, 0.5)(0.25, 0.5, 0.125, 0.25) + (0.125, 0.25, 0.5, 0.5) = (0.375, 0.75, 0.625, 0.75)
      = (96, 192, 159, 192) Cela donne une couleur de pixel finale (96, 192, 159, 192), et donnera une image comme celle montrée ci-dessous: J'espère que vous pouvez maintenant voir clairement ce que font les facteurs du mode de fusion et comment leur combinaison peut changer ce qui est dessiné pour créer des effets intéressants. Nous allons maintenant examiner un exemple pratique de la façon de combiner ces facteurs pour créer vos propres modes de fusion personnalisés. Maintenant que vous savez comment le réglage des modes de fusion fonctionne et que vous en avez vu un exemple utilisé pour le dessin quotidien, regardons quelque chose d'un peu plus complexe... CRÉER VOS PROPRES MODES DE MÉLANGE En utilisant les différents facteurs disponibles, vous pouvez créer vos propres modes de fusion pour obtenir des options de fusion qui ne vous sont pas normalement disponibles. Dans cet exemple, nous allons créer un effet de multiplication comme celui utilisé dans Photoshop. Nous pouvons simuler ce mode de fusion en utilisant deux de nos constantes de facteur de mode de fusion mentionnées ci-dessus comme ceci:gpu_set_blendmode_ext(bm_dest_colour, bm_zero); Avant de dessiner quelque chose en utilisant ce mode de fusion, voyons à quoi cela devrait ressembler dans Photoshop: En utilisant notre mode de fusion étendu, nous obtenons ce qui suit:(Rs, Gs, Bs, As) * (Rd, Gd, Bd, Ad) + (Rd, Gd, Bd, Ad) * (0,0,0,0) = (Rs, Gs, Bs, As) * (Rd, Gd, Bd, Ad) Source colour * dest colour + dest colour * zero = source colour * dest colour Le facteur de mélange bm_zero supprime efficacement la couleur de destination de l'équation (comme zéro fois tout est zéro), nous nous retrouvons donc avec la couleur source multipliée par le facteur de fusion de la couleur de destination, d'où le nom «multiplier» pour le mode. Pour utiliser ceci dans GameMaker Studio 2, vous auriez simplement quelque chose comme ceci dans votre événement de tirage au sort:gpu_set_blendmode_ext(bm_dest_colour, bm_zero); draw_self();
     gpu_set_blendmode(bm_normal);
   L'image suivante a été prise à partir d'un projet de test dans GameMaker utilisant ce code exact: Pouvez-vous repérer la différence? Probablement pas! Il y aura cependant un certain écart entre les deux en raison des différences entre les outils de rendu utilisés, mais c'est presque exactement ce à quoi vous vous attendez. Notez cependant que tous les modes de fusion utilisés par les programmes artistiques ne sont pas disponibles dans GameMaker Studio 2 car certains d'entre eux peuvent en fait forcer les valeurs de couleur à dépasser 255 et ainsi créer des effets spéciaux, mais cela ne signifie pas que vous ne peut pas créer d'imitations passables de ces effets, ni même de nouveaux effets, en les utilisant. Il convient de mentionner qu'avec GameMaker Studio 2 vous pouvez aller plus loin en utilisant la fonction gpu_set_blendmode_ext_sepalpha(). Cela vous permet de séparer la composante alpha des différents facteurs de mode de fusion et de les utiliser individuellement pour créer encore plus de combinaisons possibles. Nous ne couvrirons pas cette fonction ici car elle est déjà expliquée en détail dans le manuel, mais cela vaut la peine de la mentionner juste pour que vous sachiez qu'elle est disponible. SURFACES ET ALPHA Une dernière chose à noter à propos des modes de fusion, c'est comment ils affectent la composante alpha d'une couleur. Lorsque vous dessinez simplement sur la surface de l'application ou le tampon d'affichage, vous n'avez pas vraiment besoin de prendre en compte la valeur alpha de destination car elle en sera toujours une. Cependant, les surfaces que vous créez vous-même sont différentes, car vous pouvez effacer une surface pour avoir une valeur alpha de zéro à une que vous souhaitez. Cela conduit à des effets intéressants qui sont contraires à ce à quoi la plupart des gens s'attendent. Pour illustrer cela, nous allons regarder le dessin en utilisant la valeur par défaut de base bm_normal. La plupart des gens pensent qu'avoir une surface nettoyée à alpha 0, puis dessiner quelque chose avec un alpha de 0,5 donnera également une valeur alpha de 0,5... mais ce n'est pas le cas et c'est quelque chose que beaucoup de gens pensent être un "bug" dans la façon dont GameMaker Studio 2 rend les choses. Cependant, comme vous le verrez, ce n'est pas du tout un bug! Supposons que vous ayez une surface avec chaque pixel à alpha 0, puis vous dessinez un cercle dessus avec alpha 0,5 en utilisant le bm_normal mode de fusion. La surface entière sera toujours alpha 0, mais dans le cercle, l'alpha sera en réalité 0,25, car:0.5 * 0.5 + 0 * 0.5 = 0.5 * 0.5 = 0.25 Si vous continuez à dessiner un autre cercle dans le cercle existant, également avec un alpha de 0,5, alors l'alpha à l'extérieur des cercles serait 0, entre les cercles 0,25 et dans le cercle plus petit, il serait de 0,375:0.5 * 0.5 + 0.25 * 0.5 = 0.25 + 0.125 = 0.375 Si vous deviez continuer à dessiner un nombre de 0,5 cercles alpha sur une surface avec 0 alpha, puis dessiner cette surface dans la pièce, vous seriez en mesure de voir clairement ceci: Si vous êtes encore un peu confus au sujet de l'alpha, essayez de l'imaginer comme une autre couleur. Il se comporte comme une couleur et tous les calculs sont effectués de la même manière. Ce n'est tout simplement pas vraiment visible, bien que l'effet que cela ait sur les autres couleurs le soit. Ce qui nous amène à la dernière chose à noter lors de l'utilisation de surfaces et de modes de fusion (même bm_normal )... Même si l'alpha de la surface est 0, les composants de couleur sont toujours là et existent et auront une influence sur toutes les opérations de fusion. Ainsi, dessiner sur une surface dégagée à zéro alpha qui a été effacée en utilisant la couleur rouge (par exemple) mélangera les couleurs source avec les couleurs de destination et donnera des effets différents à ce que vous pourriez penser. L'image ci-dessus a été créée sur une surface éclaircie en noir sur un fond noir, mais si nous nettoyons la surface en rouge, nous obtenons ceci à la place: J'espère que vous pourrez maintenant comprendre pourquoi cela se produit par vous-même en utilisant les formules que j'ai décrites ci-dessus et en appliquant les chiffres appropriés pour bm_normal.  Retour: Informations complémentaires Suivant: Rapport d'erreurs © Copyright YoYo Games Ltd. 2021 Tous droits réservés
  
  
  

